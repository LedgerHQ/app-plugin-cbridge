import "core-js/stable";
import "regenerator-runtime/runtime";
import {
  waitForAppScreen,
  zemu,
  nano_models,
  txFromEtherscan,
} from "./test.fixture";

// https://etherscan.io/tx/0x4e004dbe12be23f265f8e8b649b6e875a5f31d303a83511015791a2dd41a9ad1
const testRefund = (model) => {
    test(
      "[Nano " + model.letter + "] refund tokens",
      zemu(model, async (sim, eth) => {
        // The rawTx of the tx up above is accessible through: https://etherscan.io/getRawTx?tx=0x4e004dbe12be23f265f8e8b649b6e875a5f31d303a83511015791a2dd41a9ad1

        const serializedTx = txFromEtherscan(
          "0x02f90b54018257d6843b9aca0085746a5288008304f4e394b37d31b2a74029b5951a2778f959282e2d51859580b90ae4a21a92800000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000005a0000000000000000000000000000000000000000000000000000000000000084000000000000000000000000000000000000000000000000000000000000000740a14c834fa996fa3bec7aad3693af486ae53d8aa8b50121493f9eacdd2aa5268b358600a9f9d1b2d07a1dd2a1a0b060979b0baa02697bb0dc9221493f9eacdd2aa5268b358600a9f9d1b2d07a1dd2a28840a322004d45acd527a82ace418caa5299c78c5efc8f88a95f27b64261790ae1b5f9baa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003e00000000000000000000000000000000000000000000000000000000000000041a307dc26d7941ca63f0544eef2c87cd59f2558d122879a83ee857a15fbb1a22a154c13ae6ceab3a1582d764f8e47850b752804b5fd1e9c7c595cd5daca167d4d1c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041f14dd6869e09b92ac70be1a1dfb24d640b9f03a7931fbca963acb0436e0796c63f177096d06095318777ca375db8f71bbdbb10131a4a17e318c7fb9abd0751781c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000411853282cfecc248b6c1bed07e824c47cf7843acd2c4527c4d5a7efc5f42a09d07d408a77cf375c6f24cfd44b52ae49f0b446c1502b9bf346593ab1b908a163651c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004149c4e824f9b8d87bb87cc6b2fdf591a9590d6b3eec99c13e224968c29addd4342d8ac8ba259c0d9dab68017e5207185fea7b7e239f073f44cb08f7ec391fcb0c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004142cebb49777e1dc5d7b809e593ce2cc0ee84b5556e8cf358eb082f30d25bf53b6b2d7b31593cd9f41a61655c0ab5d774b87cf89a195f24b48395296e8182d1281c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041102255832a2b26836d9bf1cb70fe4da8561df967772487eabb165a132650b4a66d1d2947e7fa58ebaa22a339fc139614e9a997b934b59efaa97c5a9debd25dc01c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000411eccd305ef6a4e647103a98882647d647c9e74b8c857a957f45bbac1a7296e700f0313b8626fa4f14d2db811afcf7f07657095d037efa64d58ca71ebb0b5ebd61c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000241a100333eefa2efc389ec836a6ff619fc1c644000000000000000000000000273035e10f106499eface385dba07135e7cc8e5400000000000000000000000055f4a1bfc655cf55ed325f2338a1dee84f754df2000000000000000000000000870cf8dd5d9c8eb1403dfd6e6a4753f4d617a53800000000000000000000000095016e36adb4e0151735ced3992a7fa54e16bd08000000000000000000000000954adc74481634b4d278c459853b4e6cc17ae8d200000000000000000000000098e9d288743839e96a8005a6b51c770bbf7788c00000000000000000000000009a66644084108a1bc23a9ccd50d6d63e53098db60000000000000000000000009a8cfacf513fb3d5e39f5952c8608e985b3dc6ef0000000000000000000000009ac5279013edfec74c5c2976fc831ad0527402e00000000000000000000000009cd5006e1bff785dad5869efd81a2c42545c9d9b000000000000000000000000a73b339c3fae27bedf7cb72d9d000b08fc899609000000000000000000000000bfa2f68bf9ad60dc3cfb1cef04730eb7fa251424000000000000000000000000c74acab8c0a340f585d008cb521d64d2554171a8000000000000000000000000cf12dd34d7597d06ff98f85d2b9483d9d5f7d952000000000000000000000000d10c833f4305e1053a64bc738c550381f48104ca000000000000000000000000f3d912e7fb180acdea31a52797d55ee2988ab907000000000000000000000000f4151eebfa1b9c87dd92c8243a18b1baef8c1813000000000000000000000000f5ad7f3782e8a67bffa297684e27cf9fcc781be1000000000000000000000000f6e93eb288658de5e2e982f99d2b378b22959d15000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000030de9251ce0f797fae00000000000000000000000000000000000000000000007e7c22d53ccdddf48f00000000000000000000000000000000000000000000001e5eb3e414c9385d18000000000000000000000000000000000000000000000039ef5c090cbe81c0d200000000000000000000000000000000000000000000001bbbeaa716a7ca2c78000000000000000000000000000000000000000000000034e3acdeb789b226f60000000000000000000000000000000000000000000000b11bc34016b62f53620000000000000000000000000000000000000000000001157b88b06a2267e042a00000000000000000000000000000000000000000000028357c8b0405936758c000000000000000000000000000000000000000000000288c3111ba1236ce6e000000000000000000000000000000000000000000000115623c2b8816ac8bfd000000000000000000000000000000000000000000000053f65f36a14d9312cc0000000000000000000000000000000000000000000000d39e631c063213a94100000000000000000000000000000000000000000000003e2c9e75dd7e10473200000000000000000000000000000000000000000000003caa2b56e3ae04441700000000000000000000000000000000000000000000007c51d3ef1c1934a7e9000000000000000000000000000000000000000000000008c6f79c577236563660000000000000000000000000000000000000000000002a4b0acb583e0d39d7000000000000000000000000000000000000000000000031f62c63e226f6774900000000000000000000000000000000000000000000003edda033841fd8249c0000c080a033984abb0672020c25e3931caba353b6fe0f4948bc8170f74eb3469d722d6f8ba0702645005db3fb5855001552a651129887a8c6e0d7c6f7f230db10e248bffa00"
        );

        const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);

        const right_clicks = 4;

        // Wait for the application to actually load and parse the transaction
        await waitForAppScreen(sim);
        // Navigate the display by pressing the right button `right_clicks` times, then pressing both buttons to accept the transaction.
        await sim.navigateAndCompareSnapshots(
          ".",
          "ethereum_refund_" + model.name + "_cbridge",
          [right_clicks, 0]
        );

        await tx;
      })
    );
}

nano_models.forEach(function (model) {
  testRefund(model);
});
